//@version=5
indicator("OTA CLICK Demand Zone Only", overlay=true)

// === Inputs ===
zoneWidth = input.int(20, title="Zone Extension Bars")
impulseThreshold = input.float(1.5, title="Min Impulse %")
showLabels = input.bool(true, title="Show Labels")

// === Functions ===
isBaseCandle(idx) =>
    abs(open[idx] - close[idx]) < (high[idx] - low[idx]) * 0.4

// === Detection Logic ===
baseFound = isBaseCandle(1) and isBaseCandle(2) and isBaseCandle(3)
rallyFromBase = close > high[1] and ((close - low[1]) / low[1]) * 100 > impulseThreshold

// === Persistent Objects ===
var box demandBox = na
var label demandLabel = na

// === Demand Zone Drawing ===
if baseFound and rallyFromBase
    demandLow = math.min(math.min(low[1], low[2]), low[3])
    demandHigh = math.max(math.max(high[1], high[2]), high[3])

    // Delete previous box and label
    if not na(demandBox)
        box.delete(demandBox)
    if not na(demandLabel)
        label.delete(demandLabel)

    // Create demand zone box
    demandBox := box.new(
        left=bar_index,
        right=bar_index + zoneWidth,
        top=demandHigh,
        bottom=demandLow,
        border_color=color.green,
        bgcolor=color.new(color.green, 85)
    )

    // Create label
    if showLabels
        demandLabel := label.new(
            x=bar_index,
            y=demandLow,
            text="Demand Zone",
            style=label.style_label_up,
            color=color.green,
            textcolor=color.white
        )
